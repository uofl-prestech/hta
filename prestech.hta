<!DOCTYPE html>
<html>

<head>
    <title>OOP Task Sequence Selections</title>
    <meta http-equiv="x-ua-compatible" content="ie=9">
    <link rel="stylesheet" href="./js/jquery-ui-1.11.4.custom/jquery-ui.css">
    <link rel="stylesheet" href="./js/jquery.mCustomScrollbar.css">
    <script src="./js/html5shiv.min.js"></script>
    <script src="./js/html5shiv-printshiv.min.js"></script>
    <script src="./js/jquery-1.11.1.min.js"></script>
    <script src="./js/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="./js/jquery-ui-1.11.4.custom/jquery-ui.min.js"></script>
    <script src="./js/spin.js"></script>
    <script src="./HTAfunctions.vbs" type="text/vbscript" language="vbscript"></script>
    <script src="./bitlockerFunctions.vbs" type="text/vbscript" language="vbscript"></script>
    <script type="text/vbscript" language="vbscript">
        window.resizeTo 1024,768
    </script>
    <link rel="stylesheet" href="Prestech.css">
    <hta:application applicationname="OOP Task Sequence Selections" border="thin" innerborder="no" caption="yes" scroll="no"
        windowstate="normal"></hta:application>
</head>

<body>
    <div id="container">
        <div id="header" class="on-load">
            <h1>PRESTECH HTA</h1>
        </div>
        <div id="main" class="on-load">
            <div class="navigation-bar">
                <ul>
                    <li id="button-osd" class="first button-nav show-output">
                        <img src="images/osd final.png" class="icon">
                        <span>OSD</span>
                    </li>
                    <li id="button-flushfill" class="button-nav">
                        <img src="images/flush and fill final.png" class="icon">
                        <span>Flush and Fill</span>
                    </li>
                    <li id="button-dism" class="button-nav">
                        <img src="images/DISM final.png" class="icon">
                        <span>DISM</span>
                    </li>
                    <li id="button-usmt" class="button-nav">
                        <img src="images/usmt final.png" class="icon">
                        <span>USMT</span>
                    </li>
                    <li id="button-software" class="button-nav">
                        <img src="images/software install.png" class="icon">
                        <span>Software Install</span>
                    </li>
                    <li id="button-tools" class="button-nav">
                        <img src="images/tools-icon.png" class="icon">
                        <span>Tools</span>
                    </li>
                </ul>
                <div class="">
                    <button id="button-home" class="button-exithome button-nav"><img src="images/house fade.png" class="icon-tools">Home</button>
                    <button class="button-exithome button-nav" onclick="vbscript:ButtonExitClick()"><img src="images/house outline1.png" class="icon-tools">Exit</button>
                </div>
            </div>

            <div id="content">
                <div class="category-header">
                    <button class="small-button" id="button-ShowAll"><img src="images/expand.png" class="icon-only"></button>
                    <button class="small-button" id="button-HideAll"><img src="images/collapse.png" class="icon-only"></button>
                    <h4 id="header-landing" class="header-text">OOP Task Sequence Selections</h4>
                    <h4 id="header-osd" class="header-text">Operating System Deployment</h4>
                    <h4 id="header-flushfill" class="header-text">OS Upgrade with User Data Migration: "Flush and Fill"</h4>
                    <h4 id="header-dism" class="header-text">Deployment Image Servicing and Management</h4>
                    <h4 id="header-usmt" class="header-text">
                        <button class="small-button usmtStates" id="button-ScanState">Scan</button>
                        <button class="small-button usmtStates" id="button-LoadState">Load</button> User State Migration
                        Tool
                    </h4>
                    <h4 id="header-software" class="header-text">Software Installation</h4>
                    <h4 id="header-tools" class="header-text">Troubleshooting Tools</h4>
                </div>
                <!--Landing Page-->
                <div id="page-landing" class="pages"></div>

                <!--OSD Page-->
                <div id="page-osd" class="pages">
                    <ul id="ul-osd" class="accordion ui-accordion ul-elements"></ul>
                    <button class="button" id="launch-osd" onclick="javascript:launchOSD()"><img src="images/launch-icon.png" class="icon-tools">Launch OSD</button>
                </div>

                <!-- Flush and Fill Page -->
                <div id="page-flushfill" class="pages">
                    <ul id="ul-fnf" class="accordion ui-accordion ul-elements"></ul>
                    <button class="button show-output" id="fnf-capture" onclick="javascript:launchFNF()"><img src="images/launch-icon.png" class="icon-tools">Begin!</button>
                </div>

                <!--DISM Page-->
                <div id="page-dism" class="pages">
                    <ul id="ul-dism" class="accordion ui-accordion ul-elements"></ul>
                    <button class="button show-output" id="dism-capture" onclick="javascript:launchDISM()"><img src="images/DISM final.png" class="icon-tools">Capture Image</button>
                </div>

                <!--USMT Page-->
                <div id="page-usmt" class="pages">
                    <ul id="ul-usmt" class="accordion ui-accordion ul-elements"></ul>
                    <button class="button show-output" id="run-usmt" onclick="javascript:launchScanstate()"><img src="images/launch-icon.png" class="icon-tools">Run USMT</button>
                    <button class="button show-output" id="run-LoadState" onclick="javascript:launchLoadstate()"><img src="images/launch-icon.png" class="icon-tools">LoadState</button>
                </div>

                <!--Software Install Page-->
                <div id="page-software-install" class="pages">
                    <ul id="ul-software-install" class="accordion ui-accordion ul-elements"></ul>
                </div>

                <!--Troubleshooting Tools Page-->
                <div id="page-tools" class="pages">
                    <div class="tools-button-bar">
                        <button class="button button-bl-info show-output" id="button-bitlocker" onclick="javascript:blInfoClick()"><img src="images/bitlocker-icon.png" class="icon-tools">Bitlocker Info</button>
                        <button class="button" id="button-cmdprompt" name="cmdWindow" onclick="vbscript:cmdPrompt()"><img src="images/command-prompt-icon.png" class="icon-tools">Command Prompt</button>
                        <button class="button" id="button-explorer" name="explorer" onclick="vbscript:explorer()"><img src="images/explorer-icon.png" class="icon-tools">Explorer ++</button>
                        <button class="button" id="button-logviewer" name="logViewer" onclick="vbscript:logViewer()"><img src="images/cmtrace-icon.png" class="icon-tools">Log Viewer</button>
                        <button class="button show-output" id="button-pingtest" name="ping" onclick="vbscript:pingTest()"><img src="images/ping-icon.png" class="icon-tools">Ping Test</button>
                        <button class="button" id="button-psPrompt" name="ps" onclick="vbscript:psPrompt()"><img src="images/ping-icon.png" class="icon-tools">Powershell</button>
                        <button class="button" id="button-npp" name="notepadpp" onclick="vbscript:notepadPP()"><img src="images/code-icon.svg" class="icon-tools">Notepad ++</button>
                    </div>
                </div>
                <div id="general-output-scroll">
                    <div id="general-output">.general-output</div>
                </div>
                <!--    End content    -->
            </div>
            <!--    End main    -->
        </div>
        <!--    End container    -->
    </div>

    <!--    OSD Options    -->
    <template id="temp-osd-options">
        <li id="li-osd-options" class="li-steps">
            <h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons">
                <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>OSD Options
            </h3>
            <div id="div-format-drive" class="ui-widget-content">
                <input id="input-osd-checkbox" class="input-objects" type="checkbox" name="OSD"> Format Drive and Deploy
                Image (OSD)?
                <input id="input-tpm-checkbox" class="input-objects" type="checkbox" name="TPMCheckBox">
            </div>
        </li>
    </template>

    <!--    Computer Name    -->
    <template id="temp-computer-name">
        <li id="li-computer-name" class="li-steps">
            <h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons">
                <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>Enter Computer Name
            </h3>
            <div id="div-computer-name" class="ui-widget-content"> Computer Name: &nbsp; &nbsp; <input id="input-comp-name" class="input-objects" type="text" name="compName"> <br></div>
        </li>
    </template>

    <!--    Software Install    -->
    <template id="temp-software-install">
        <li id="li-software-install" class="li-steps">
            <h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons">
                <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>Select Software to Install
            </h3>
            <div id="div-software-install" class="ui-widget-content">
                <input type="checkbox" id="AdobeReaderDC" class="software-install input-objects" name="AdobeReaderDC">Adobe
                Reader DC<br>
                <input type="checkbox" id="AdobeAcrobatProXI" class="software-install input-objects" name="AdobeAcrobatProXI">Adobe
                Acrobat Pro XI<br>
                <input type="checkbox" id="Chrome" class="software-install input-objects" name="Chrome">Chrome 58<br>
                <input type="checkbox" id="FileMaker" class="software-install input-objects" name="FileMaker">FileMaker Pro
                16
                <br>
                <input type="checkbox" id="Office2016" class="software-install input-objects" name="Office2016">Office 2016
                (32 Bit)<br>
                <input type="checkbox" id="MBAM" class="software-install input-objects" name="MBAM">MBAM Client (Bitlocker)
                <br>
            </div>
        </li>
    </template>

    <!--    Bitlocker Info    -->
    <template id="temp-bitlocker-info">
        <li id="li-bitlocker-info" class="li-steps scanState">
            <h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons">
                <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>Get Bitlocker Info
            </h3>
            <div id="div-bitlocker-info" class="ui-widget-content">
                <button id="bl-info" class="button button-bl-info show-output" onclick="javascript:blInfoClick()"><img src="images/bitlocker-icon.png" class="icon-tools">Bitlocker Info</button>
            </div>
        </li>
    </template>

    <!--    Windows Drive    -->
    <template id="temp-windows-drive">
        <li id="li-windows-drive" class="li-steps scanState">
            <h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons">
                <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>Enter the drive letter of the
                Windows partition to be imaged
            </h3>
            <div id="div-windows-drive" class="ui-widget-content">
                <span>Drive Letter: &nbsp&nbsp </span><input id="input-windows-drive" class="drive-input input-objects" name="windowsDrive" 
                    type="Text" maxlength="1" size="1">
            </div>
        </li>
    </template>

    <!--    Bitlocker Unlock    -->
    <template id="temp-bitlocker-unlock">
        <li id="li-bitlocker-unlock" class="li-steps scanState">
            <h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons">
                <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>Enter the Recovery Key to unlock
                Bitlocker
            </h3>
            <div id="div-bitlocker-unlock" class="ui-widget-content">
                <input id="input-bitlocker-key" class="input-objects" name="blKey" type="Text" maxlength="100" size="35" value="">
                <button id="bl-unlock" class="button button-bl-unlock show-output" onclick="javascript:blUnlockClick()"><img src="images/bitlocker-unlock-icon.png" class="icon-tools">Bitlocker Unlock</button>
            </div>
        </li>
    </template>

    <!--    Primary Username    -->
    <template id="temp-primary-username">
        <li id="li-primary-username" class="li-steps">
            <h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons">
                <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>Enter the username of the user
                we are copying data for
            </h3>
            <div id="div-primary-username" class="ui-widget-content">
                <span>Username: &nbsp&nbsp </span>
                <input id="input-primary-username" class="input-objects" name="primaryUsername" type="Text" size="15">
            </div>
        </li>
    </template>

    <!--    External Drive    -->
    <template id="temp-external-drive">
        <li id="li-external-drive" class="li-steps">
            <h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons">
                <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>Enter the drive letter of the
                External USB drive where the image will be stored
            </h3>
            <div id="div-external-drive" class="ui-widget-content">
                <span>Drive Letter: &nbsp&nbsp </span><input id="input-external-drive" class="drive-input input-objects"
                    name="externalDrive" type="Text" maxlength="1" size="1">
            </div>
        </li>
    </template>

    <!--    Select Users    -->
    <template id="temp-select-users">
        <li id="li-select-users" class="li-steps scanState">
            <h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons">
                <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>Select users for which data will
                be copied
            </h3>
            <div id="div-select-users" class="ui-widget-content usmt-users"></div>
        </li>
    </template>

    <!--    FnF Options    -->
    <template id="temp-fnf-options">
        <li id="li-fnf-options" class="li-steps">
            <h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons">
                <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>Flush and Fill Options</h3>
            <div id="div-fnf-options" class="ui-widget-content">
                <input id="input-dism-checkbox" class="input-objects" type="checkbox" name="dismCheckBox"> Create Backup
                Image (DISM)? <br>
                <input id="input-scanstate-checkbox" class="input-objects" type="checkbox" name="scanStateCheckBox"> Save
                User Data (USMT Scanstate)?
                <br>
                <input id="input-fnfosd-checkbox" class="input-objects" type="checkbox" name="fnfOsdCheckBox"> Format Drive
                and Deploy Image (OSD)?
                <br>
                <input id="input-loadstate-checkbox" class="input-objects" type="checkbox" name="loadStateCheckBox"> Restore
                User Data after OSD (USMT Loadstate)?
                <br>
            </div>
        </li>
    </template>

</body>

<!--************************************ JavaScript functions ************************************-->

<script language="JavaScript">
    $(document).ready(function () {
        $('.pages').css('display', 'none');
        $('.header-text').css('display', 'none');
        $('#page-landing').css('display', 'inline-block');
        $('#header-landing').css('display', 'inline');
        $('#general-output').css('visibility', 'hidden');

        try {
            listDrives();
            TPMCheck();
        }
        catch (err) {
            $('#page-landing').append(err.message);
        }

        $(".pages").mCustomScrollbar({
            theme: "minimal"
        });
        $("#general-output-scroll").mCustomScrollbar({
            theme: "minimal"
        });
    });

    function initAccordion() {
        $('.accordion h3').click(function () {
            $(this).next().toggle('fast');
            $(this).children().toggleClass("ui-icon-triangle-1-e ui-icon-triangle-1-s");
            return false;
        }).next().hide();
        $('.ui-widget-content').show('fast');
        $('.ui-widget-content').prev().children().removeClass("ui-icon-triangle-1-e ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-s");
    }


    // ******************** Navigation Buttons ********************
    $('#button-ShowAll').on('click', function () {
        $('.ui-widget-content').show('fast');
        $('.ui-widget-content').prev().children().removeClass("ui-icon-triangle-1-e ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-s");
    });

    $('#button-HideAll').on('click', function () {
        $('.ui-widget-content').hide('fast');
        $('.ui-widget-content').prev().children().removeClass("ui-icon-triangle-1-e ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-e");
    });
    // #general-output hidden/visible functions
    $('.button-nav').on('click', function () {
        $('.pages').css('display', 'none');
        $('.header-text').css('display', 'none');
        $('.button-nav').removeClass('active');
        $(this).addClass('active');
        $("#general-output").css('visibility', 'hidden');
    });
    $(document).on('click', '.show-output', function () {
        $("#general-output").css('visibility', 'visible');
    });

    // Bitlocker loading spinner
    function blInfoClick() {
        $("#general-output").css('visibility', 'visible');
        var target = document.getElementById('general-output');
        var opts = {
            color: '#FFF'
        }
        var spinner = new Spinner(opts).spin(target);
        BitlockerInfo();
        spinner.stop(target);

    }
    function blUnlockClick() {
        $("#general-output").css('visibility', 'visible');
        var target = document.getElementById('general-output');
        var opts = {
            color: '#FFF'
        }
        var spinner = new Spinner(opts).spin(target);
        BitlockerUnlock();
        spinner.stop(target);
    }
    $('#button-osd').on('click', function () {
        $('#page-osd').css('display', 'inline-block');
        $('#header-osd').css('display', 'inline');

        try {
            TPMCheck();
        }
        catch (err) {
            document.getElementById("general-output").innerHTML = err.message;
        }

        if ($("#ul-osd").children().length == 0) {
            $(".ul-elements").empty();
            var template = $("#temp-osd-options").html();
            template += $("#temp-computer-name").html();
            template += $("#temp-software-install").html();
            $("#ul-osd").append(template);
            initAccordion();
        }
    });

    $('#button-flushfill').on('click', function () {
        $('#page-flushfill').css('display', 'inline-block');
        $('#header-flushfill').css('display', 'inline');

        if ($("#ul-fnf").children().length == 0) {
            $(".ul-elements").empty();
            var template = $("#temp-fnf-options").html();
            template += $("#temp-bitlocker-info").html();
            template += $("#temp-windows-drive").html();
            template += $("#temp-bitlocker-unlock").html();
            template += $("#temp-select-users").html();
            template += $("#temp-primary-username").html();
            template += $("#temp-external-drive").html();
            template += $("#temp-computer-name").html();
            template += $("#temp-software-install").html();
            $("#ul-fnf").append(template);
            initAccordion();
        }
        if ($("#input-usmt-usernames").length == 0) {
            enumUsers();
        }
    });

    $('#button-dism').on('click', function () {
        $('#page-dism').css('display', 'inline-block');
        $('#header-dism').css('display', 'inline');

        if ($("#ul-dism").children().length == 0) {
            $(".ul-elements").empty();
            var template = $("#temp-bitlocker-info").html();
            template += $("#temp-windows-drive").html();
            template += $("#temp-bitlocker-unlock").html();
            template += $("#temp-primary-username").html();
            template += $("#temp-external-drive").html();
            $("#ul-dism").append(template);
            initAccordion();
        }
    });

    $('#button-usmt').on('click', function () {
        $('#page-usmt').css('display', 'inline-block');
        $('#header-usmt').css('display', 'inline');

        if ($("#ul-usmt").children().length == 0) {
            $(".ul-elements").empty();
            var template = $("#temp-bitlocker-info").html();
            template += $("#temp-windows-drive").html();
            template += $("#temp-bitlocker-unlock").html();
            template += $("#temp-select-users").html();
            template += $("#temp-primary-username").html();
            template += $("#temp-external-drive").html();
            $("#ul-usmt").append(template);
            initAccordion();
        }

        if ($("#input-usmt-usernames").length == 0) {
            enumUsers();
        }
    });

    $('#button-software').on('click', function () {
        $('#page-software-install').css('display', 'inline-block');
        $('#header-software').css('display', 'inline');

        if ($("#ul-software-install").children().length == 0) {
            $(".ul-elements").empty();
            var template = $("#temp-software-install").html();
            $("#ul-software-install").append(template);
            initAccordion();
        }
    });

    $('#button-tools').on('click', function () {
        $('#page-tools').css('display', 'inline-block');
        $('#header-tools').css('display', 'inline');
    });
    $('#button-home').on('click', function () {
        $('#page-landing').css('display', 'inline-block');
        $('#header-landing').css('display', 'inline');
    });


    // ******************** Misc Buttons ********************
    function getInputValues() {
        var inputValues = {};
        $(".input-objects").each(function () {
            //If this input is a checkbox, get the value of prop("checked") instead of val()
            if ($(this).attr("type") == "checkbox") {
                inputValues[$(this).prop("name")] = $(this).prop("checked");
            }
            //If this input is a text input field, get val()
            else {
                inputValues[$(this).attr("name")] = $(this).val();
            }
        });
        return inputValues;
    }

/*******************************
************* OSD **************
*******************************/
    function launchOSD() {
        var capturedVars = getInputValues();

        if (capturedVars.TPMCheckbox != true) {
            alert("TPM is not functioning or not present!");
        }
        else if (capturedVars.OSDCheckbox != true) {
            alert("OSD checkbox not checked!");
        }        
        else if (capturedVars.ComputerName == "") {
            alert("Computer name not filled in!");
        }
        else {
            $(".pages").mCustomScrollbar("disable");
            $("#general-output").mCustomScrollbar("disable");
            ButtonFinishClick();
        }
    }

/*******************************
************* FnF **************
*******************************/
    function launchFNF() {
        $(".pages").mCustomScrollbar("disable");
        $("#general-output").mCustomScrollbar("disable");

        var selectedUsers = {};
        $('#input-usmt-usernames :selected').each(function () {
            selectedUsers[$(this).text()] = $(this).val();
        });

        var capturedVars = getInputValues();

        for (user in selectedUsers) {
            capturedVars[user] = selectedUsers[user];
        }
        var capturedVarsString = JSON.stringify(capturedVars);

        //runFlushFill2(capturedVarsString);

        runFlushFill();
    }

/*******************************
************* DISM *************
*******************************/
    function launchDISM() {
        var capturedVars = getInputValues();

        //Disable scroll bar replacement because it causes a slow script warning after dism finishes
        $(".pages").mCustomScrollbar("disable");
        $("#general-output").mCustomScrollbar("disable");

        dismCapture();

        //Re-enable scroll bar replacement
        setTimeout(function () {
            $(".pages").mCustomScrollbar("update");
            $("#general-output").mCustomScrollbar("update");
        }, 2000);
    }

/*******************************
************* USMT *************
*******************************/
    function launchScanstate() {
        var selectedUsers = {};
        $('#input-usmt-usernames :selected').each(function () {
            selectedUsers[$(this).text()] = $(this).val();
        });

        var capturedVars = getInputValues();
        for (user in selectedUsers) {
            capturedVars[user] = selectedUsers[user];
        }

        $(".pages").mCustomScrollbar("disable");
        $("#general-output").mCustomScrollbar("disable");

        usmtScanstate("true");

        setTimeout(function () {
            $(".pages").mCustomScrollbar("update");
            $("#general-output").mCustomScrollbar("update");
        }, 2000);
    }

    function launchLoadstate() {
        var capturedVars = getInputValues();

        $(".pages").mCustomScrollbar("disable");
        $("#general-output").mCustomScrollbar("disable");

        usmtLoadstate();

        setTimeout(function () {
            $(".pages").mCustomScrollbar("update");
            $("#general-output").mCustomScrollbar("update");
        }, 2000);
    }

    $('#button-ScanState').on('click', function () {
        $('.scanState').css('display', 'list-item');
        $('#run-usmt').css('display', 'inline-block');
        $('#run-LoadState').css('display', 'none');
    });

    $('#button-LoadState').on('click', function () {
        $('.scanState').css('display', 'none');
        $('#run-LoadState').css('display', 'inline-block');
        $('#run-usmt').css('display', 'none');
    });


    // $("#input-windows-drive, #input-primary-username").keyup(function () {
    //     usmtScanstate("false");
    // });

    $(".on-load").delay(200).animate({ "opacity": "1" }, 700);

</script>

</html>